<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Task - 2</title>

  <!-- BABEL Don't use this in production: -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- reactJS -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin>
  </script>

  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin>
  </script>

  <!-- mysql -->
  <script src="https://cdn.jsdelivr.net/npm/mysql@2.18.1/index.min.js"></script>


  <!--
    Note: this page is a great way to try React but it's not suitable for production.
    It slowly compiles JSX with Babel in the browser and uses a large development build of React.
  -->

  <link rel="stylesheet" href="index.css">





</head>

<body>
  <button id="btn" onclick="postDataToDB()">Check DB</button>
  <p>
  <p></p>
  </p>
  <div id="modal"></div>
  <div id="root"></div>

  <script defer type="text/javascript">


  </script>

  <script defer type="text/babel">


    let noteTitle = ""
    let noteDesc = ""

    let dbNoteList = [];

    const getDbNotes = async () => {
      console.log("get-notes api is being called");
      await fetch("http://localhost:3000/get-notes",
        {
          method: "GET",

        }).then(response => response.json())
        .then(data => {
          dbNoteList = data;
          console.log(dbNoteList);

        }).catch(error => {
          console.log("Error", error)
        })
    }

    // getting dbNotes when page is loaded
    setTimeout(getDbNotes, 0);

    const addNoteToLocalStorage = () => {
      console.log("post-note api is being called");
      fetch(
        'http://localhost:3000/post-note',
        {
          method: "POST",
          headers: {
            'Content-Type': 'application/json',
          },

          body: JSON.stringify({
            "note_title": noteTitle,
            "note_desc": noteDesc
          })
        }).then(response => {
          if (!response.ok) {
            console.log("Status code", response.status)
            return;
          }
          return response.json();
        }).then(data => {
          console.log("data")
          console.log(data)
          getDbNotes();
          const modalDiv = document.getElementById("modal");
          modalDiv.innerHTML = "";
          console.log("Closed modal");
        })
        .catch(error => {
          console.error('Error:', error);
        });


    }





    const Modal = () => {
      const onModalContainerTap = () => {
        const modalDiv = document.getElementById("modal");
        modalDiv.innerHTML = "";
        console.log("Closed modal");

      }


      // const addNoteToLocalStorage = () => {

      //   console.log("title", noteTitle)
      //   console.log("desc", noteDesc)

      // }

      const onNoteTitleChange = (event) => {
        noteTitle = event.currentTarget.value;
        console.log("Note title", noteTitle);
      }

      const onNoteDescChange = (event) => {
        noteDesc = event.currentTarget.value;
        console.log("Note Desc", noteDesc);
      }

      return <>
        <div className="modal-container" onClick={onModalContainerTap}>
        </div>
        <div className="modal">
          <div className="modal-content">
            <div id="modal-header">

              <input onChange={onNoteTitleChange}

                id="modal-note-title"
                placeholder="Enter note title"></input>

              <img src="assets/close_icon.png" id="close-modal" onClick={onModalContainerTap}>

              </img>

            </div>

            <textarea id="modal-note-description"
              onChange={onNoteDescChange}
              rows="20" cols="80"
              placeholder="Enter note description">

            </textarea>

            <div id="modal-add-note-btn">

              <div id="add-note-btn" onClick={addNoteToLocalStorage}>
                Add note
              </div>
            </div>


          </div>
        </div>
      </>
    }

    const TakeNote = () => {

      const onInputTap = () => {
        console.log('input tapped');
        const modalDiv = document.getElementById("modal");
        const root = ReactDOM.createRoot(modalDiv);
        root.render(<Modal />)
      }

      return <input id="input-note"
        readOnly="readOnly"
        onClick={onInputTap}
        placeholder="Take a note..." />
    }

    const Note = ({ note }) => {
      return <div id="child">
        <div id="child-content">
          {note.note_title}
        </div>

      </div>
    }



    const NotesApp = () => {


      return <>
        <div id="nav-bar">
          NotesApp
        </div>
        <div id="content">
          <TakeNote />


        </div>

        <div id="notes-container">
          <div id="children">
            {
              dbNoteList.map((note, index) => {
                return <Note key={index} note={note} />
              })
            }



          </div>



        </div>

      </>
    }

    const rootDiv = document.getElementById("root");
    const root = ReactDOM.createRoot(rootDiv);
    root.render(<p>Loading...</p>)

    setTimeout(() => {

      const rootDiv = document.getElementById("root");
      const root = ReactDOM.createRoot(rootDiv);
      root.render(<NotesApp />)

    }, 2000);


  </script>
</body>

</html>